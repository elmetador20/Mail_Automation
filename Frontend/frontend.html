<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TEDx Mailer</title>
</head>
<body>
  <h2>TEDx Speaker Mailer Dashboard</h2>

  <form id="speakerForm">
    <input type="text" id="name" placeholder="Name" required />
    <input type="email" id="email" placeholder="Email" required />
    <input type="text" id="topic" placeholder="Topic" required />
    <button type="submit">Add Speaker</button>
  </form>

  <button id="sendMailsBtn">Send Invitations</button>

  <ul id="speakerList"></ul>

  <script>
    const API = "http://localhost:8080/api/mail";

    async function loadSpeakers() {
      const res = await fetch(API + "/show_speakers");
      const data = await res.json();
      document.getElementById("speakerList").innerHTML =
        data.map(s => `<li>${s.name} - ${s.mailStatus}--------${s.topic}</li>`).join("");
        
        console.log(data);
    }

    document.getElementById("speakerForm").addEventListener("submit", async e => {
      e.preventDefault();
      const speaker = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        topic: document.getElementById("topic").value,
        status: "not_sent"
      };
      await fetch(API + "/addSpeaker", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(speaker)
      });
      loadSpeakers();
    });

    document.getElementById("sendMailsBtn").addEventListener("click", async () => {
      await fetch(API + "/sendInvites", { method: "POST" });
      alert("Invitations sent!");
      loadSpeakers();
    });

    loadSpeakers();
  </script>
</body>
</html>
